<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=",  ">
<title>Customizing the devfile and plug-in registries | Eclipse Che Documentation</title>
<link rel="stylesheet" href="/che/docs/css/syntax.css">
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/che/docs/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/che/docs/css/customstyles.css">
<link rel="stylesheet" href="/che/docs/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/che/docs/css/theme-che.css">


    <link rel="stylesheet" href="/che/docs/css/coderay.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/che/docs/css/asciidoc.css" type="text/css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js" crossorigin="anonymous"></script>
<script src="/che/docs/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js" crossorigin="anonymous"></script>
<script src="/che/docs/js/toc.js"></script>
<script src="/che/docs/js/customscripts.js"></script>

<link rel="shortcut icon" href="/che/docs/images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="che" href="/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: false,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Eclipse Che Documentation</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://medium.com/eclipse-che-blog/" target="_blank">Blog</a></li>
                
                
                
                <li><a href="https://github.com/eclipse/che" target="_blank">Source Code</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Che Version<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="/che/docs/che-6/index.html">Che 6</a></li>
                        
                        
                        
                        <li><a href="/che/docs/che-7/index.html">Che 7 Beta</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Support<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc+label%3Akind%2Fbug" target="_blank">Known Bugs</a></li>
                        
                        
                        
                        <li><a href="https://github.com/eclipse/che/issues/new" target="_blank">File an Issue</a></li>
                        
                        
                        
                        <li><a href="https://stackoverflow.com/questions/tagged/eclipse-che" target="_blank">Che on StackOverflow</a></li>
                        
                        
                    </ul>
                </li>
                
                
                <!-- 
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:?subject= feedback&body=I have some feedback about the Customizing the devfile and plug-in registries page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>
 -->
		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="/che/docs/js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: "/che/docs/search.json",
                                searchResultTemplate: '<li><a href="{url}" title="Customizing the devfile and plug-in registries">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Eclipse Che 7</li>
  
  
  
  <li>
      <a href="#">Overview</a>
      <ul>
          
          
          
          <li><a href="introduction-to-eclipse-che.html">Introduction to Che</a></li>
          
          
          
          
          
          
          <li><a href="che-quick-starts.html">Che quick-starts</a></li>
          
          
          
          
          
          
          <li><a href="hosted-che.html">Hosted Che</a></li>
          
          
          
          
          
          
          <li><a href="che-architecture.html">Che architecture</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">End-user Guide</a>
      <ul>
          
          
          
          <li><a href="che-theia-ide-basics.html">Che-Theia IDE basics</a></li>
          
          
          
          
          
          
          <li><a href="using-developer-environments-workspaces.html">Using developer workspaces</a></li>
          
          
          
          
          
          
          <li><a href="extending-che.html">Customizing developer environments</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Administration Guide</a>
      <ul>
          
          
          
          <li><a href="customizing-registries.html">Customizing registries</a></li>
          
          
          
          
          
          
          <li><a href="retrieving-che-logs.html">Retrieving Che logs</a></li>
          
          
          
          
          
          
          <li><a href="monitoring-che.html">Monitoring Che</a></li>
          
          
          
          
          
          
          <li><a href="tracing-che.html">Tracing Che</a></li>
          
          
          
          
          
          
          <li><a href="securing-che.html">Securing Che</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Contributor Guide</a>
      <ul>
          
          
          
          <li><a href="developing-che-theia-plug-ins.html">Developing Che-Theia plug-ins</a></li>
          
          
          
          
          
          
          <li><a href="testing-che-theia-plug-ins.html">Testing Che-Theia plug-ins</a></li>
          
          
          
          
          
          
          <li><a href="publishing-che-theia-plug-ins.html">Publishing Che-Theia plug-ins</a></li>
          
          
          
          
          
          
          <li><a href="che-extensibility-reference.html">Che extensibility reference</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block: -->
         <p class="external">
             <a href="#" id="collapseAll">Collapse all</a> | <a href="#" id="expandAll">Expand all</a>
         </p>
         
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>

            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Customizing the devfile and plug-in registries</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2' });
/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top
  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>

    


    <!-- 


     -->

  <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Che 7 introduces two registries: the plug-in registry and the devfile registry. They are static websites where the metadata of Che plug-ins and Che devfiles is published.</p>
</div>
<div class="paragraph">
<p>The plug-in registry makes it possible to share a plug-in definition across all the users of the same instance of Che. Only plug-ins that are published in a registry can be used in a devfile.</p>
</div>
<div class="paragraph">
<p>The devfile registry holds the definitions of the Che stacks. These are available on the Che user dashboard when selecting <strong>Create Workspace</strong>. It contains the list of Che technological stack samples with example projects.</p>
</div>
<div class="paragraph">
<p>The devfile and plug-in registries run in two separate pods and are deployed when the Che server is deployed (that is the default behavior of the Helm chart or the Che operator). The metadata of the plug-ins and devfiles are versioned on GitHub and follow the Che server life cycle.</p>
</div>
<div class="paragraph">
<p>In this document, the following two ways to customize the default registries that are deployed with Che (to modify the plug-ins or devfile metadata) are described:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Building a custom image of the registries</p>
</li>
<li>
<p>Running the default images but modifying them at runtime</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-and-running-a-custom-registry-image_customizing-the-devfile-and-plug-in-registries">Building and running a custom registry image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes the building of registries and updating a running Che server to point to the registries.</p>
</div>
<div class="sect2">
<h3 id="cloning-the-registries_building-and-running-a-custom-registry-image">Cloning the registries</h3>
<div class="paragraph">
<p>This section describes how to clone the devfile and plug-in registries.</p>
</div>
<div class="sect3">
<h4 id="cloning-the-plug-in-registry_cloning-the-registries">Cloning the plug-in registry</h4>
<div class="paragraph">
<p>This section describes how to clone the <strong>che-plugin-registry</strong> Git repository.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ git clone git@github.com:eclipse/che-plugin-registry.git</pre>
</div>
</div>
</li>
<li>
<p>Verify the repository has been cloned.</p>
<div class="listingblock">
<div class="content">
<pre>$ tree -L 2 ./che-plugin-registry
./che-plugin-registry
(...)
├── Dockerfile   <i class="conum" data-value="1"></i><b>(1)</b>
├── README.md    <i class="conum" data-value="2"></i><b>(2)</b>
├── kubernetes   <i class="conum" data-value="3"></i><b>(3)</b>
├── openshift    <i class="conum" data-value="4"></i><b>(4)</b>
├── plugins      <i class="conum" data-value="5"></i><b>(5)</b>
├── v2           <i class="conum" data-value="6"></i><b>(6)</b>
└── v3           <i class="conum" data-value="7"></i><b>(7)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dockerfile to build the container image</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Updated instructions to build and run the registry</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Kubernetes deployment files</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>OpenShift deployment files</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Plug-in folder</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Deprecated plug-in folder that may be removed in the future</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Deprecated plug-in folder that may be removed in the future</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="cloning-the-devfile-registry_cloning-the-registries">Cloning the devfile registry</h4>
<div class="paragraph">
<p>This section describes how to clone the <strong>che-devfile-registry</strong> Git repository.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ git clone git@github.com:eclipse/che-devfile-registry.git</pre>
</div>
</div>
</li>
<li>
<p>Verify the repository has been cloned.</p>
<div class="listingblock">
<div class="content">
<pre>$ tree -L 2 ./che-devfile-registry
./che-devfile-registry
(...)
├── Dockerfile             <i class="conum" data-value="1"></i><b>(1)</b>
├── README.md              <i class="conum" data-value="2"></i><b>(2)</b>
├── arbitrary-users-patch  <i class="conum" data-value="3"></i><b>(3)</b>
├── deploy
│ ├── kubernetes           <i class="conum" data-value="4"></i><b>(4)</b>
│ └── openshift            <i class="conum" data-value="5"></i><b>(5)</b>
└── devfiles               <i class="conum" data-value="6"></i><b>(6)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Dockerfile to build the container image</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Updated instructions to build and run the registry</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Scripts to patch images so that they work fine even if run as arbitrary users</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Kubernetes deployment files</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>OpenShift deployment files</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Devfiles folder</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modifying-the-registries_building-and-running-a-custom-registry-image">Modifying the registries</h3>
<div class="paragraph">
<p>This section explains how to modify the existing content of the devfile and plug-in registries: the devfiles and plug-in metadata.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The registries are cloned following the <a href="customizing-registries.html#cloning-the-registries_building-and-running-a-custom-registry-image">Cloning the registries</a> procedure.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="adding-a-new-plug-in_modifying-the-registries">Adding a new plug-in</h4>
<div class="paragraph">
<p>The <code>v3/plugins/</code> directory in the repository contains the plug-ins. The following is the structure of a plug-in directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./che-plugin-registry/v3/plugins
 ├── <em>&lt;publisher&gt;</em>
 ├── <em>&lt;plugin-name&gt;</em>
 ├── <em>&lt;plugin-version&gt;</em>
 └── meta.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>To add a new plug-in:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <code>v3/plugins/</code> directory, create a new directory and name it <code><em>&lt;publisher&gt;</em>/<em>&lt;plugin-name&gt;</em>/<em>&lt;plugin-version&gt;</em>/</code>.</p>
</li>
<li>
<p>Create a plug-in <code>meta.yaml</code> file in the new directory.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example</div>
<div class="paragraph">
<p>The following is an example directory called <code>my-org/my-plugin/1.0.0/</code>, and it contains a meta.yaml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir -p che-plugin-registry/v3/plugins/my-org/my-plugin/1.0.0/
$ touch che-plugin-registry/v3/plugins/my-org/my-plugin/1.0.0/meta.yaml
$ tree ./che-plugin-registry/v3/plugins
./che-plugin-registry/v3/plugins
 ├── my-org
 ├── my-plugin
 ├── 1.0.0
 └── meta.yaml</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add valid content to the <code>meta.yaml</code> file. See the “Using a Visual Studio Code extension in Che” section or the README.md file in the <code>eclipse/che-plugin-registry</code> repository for a detailed description of the <code>meta.yaml</code> file format.</p>
</li>
<li>
<p>Create a directory called <code>latest/</code> and copy the <code>meta.yaml</code> file in it, too. The <code>meta.yaml</code> file in the <code>latest/</code> directory is used when the plug-in version is not specified (in a devfile, for example).</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>latest/</code> directory should always contain a copy of the latest stable <code>meta.yaml</code> file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir che-plugin-registry/v3/plugins/my-org/my-plugin/latest/
$ copy che-plugin-registry/v3/plugins/my-org/my-plugin/1.0.0/meta.yaml \
che-plugin-registry/v3/plugins/my-org/my-plugin/latest
$ tree ./che-plugin-registry/v3/plugins
./che-plugin-registry/v3/plugins
 ├── my-org
 ├── my-plugin
 ├── 1.0.0
 ├── meta.yaml
 ├── latest
 └── meta.yaml</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="adding-a-new-devfile_modifying-the-registries">Adding a new devfile</h4>
<div class="paragraph">
<p>The <code>devfiles/</code> directory contains the devfiles. Every devfile directory has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./che-devfile-registry/devfiles
 ├── <em>&lt;stack-name&gt;</em>
 ├── devfile.yaml
 └── meta.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>To add a new devfile:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <code>devfiles/</code> directory, create a new subdirectory <code><em>&lt;stack-name&gt;</em>/</code>.</p>
</li>
<li>
<p>In this new subdirectory, add a new plug-in <code>devfile.yaml</code> file and a <code>meta.yaml</code> file. The following is an example <code>my-stack/</code> directory, and it contains a <code>devfile.yaml</code> file and a <code>meta.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre>$ mkdir -p che-devfile-registry/devfiles/my-devfile
$ touch che-devfile-registry/devfiles/my-devfile/devfile.yaml
$ touch che-devfile-registry/devfiles/my-devfile/meta.yaml
$ tree ./che-devfile-registry/devfiles
./che-devfile-registry/devfiles
 ├── my-devfile
 ├── devfile.yaml
 └── meta.yaml</pre>
</div>
</div>
</li>
<li>
<p>Add valid content in the <code>devfile.yaml</code> file. For a detailed description of the devfile format, see the <a href="using-developer-environments-workspaces.html#making-a-workspace-portable-using-a-devfile_using-developer-environments-workspaces">Making a workspace portable using a Devfile</a> section.</p>
</li>
<li>
<p>Ensure that the <code>meta.yaml</code> file conforms to the following structure:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">displayName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">My Stack                                        </span></span><i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">This is a custom stack for Che                  </span></span><i class="conum" data-value="2"></i><b>(2)</b>
<span style="color:#606">tags</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[&quot;Java&quot;, &quot;maven&quot;, &quot;ubi&quot;]                               </span></span><i class="conum" data-value="3"></i><b>(3)</b>
<span style="color:#606">icon</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">https://www.eclipse.org/che/images/logo-eclipseche.svg </span></span><i class="conum" data-value="4"></i><b>(4)</b>
<span style="color:#606">globalMemoryLimit</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">1686Mi                                    </span></span><i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of the stack as it appears on the user dashboard.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Description of the stack as it appears on the user dashboard.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tags of the stack. Tags usually include the tools included in the stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The link to an <code>.svg</code> file that is displayed on the user dashboard.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The sum of the memory limits of all the components of the stack. This number will be visible on the user dashboard. It is informative and is not taken into account by the Che server.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-the-images-of-the-registries_building-and-running-a-custom-registry-image">Building the images of the registries</h3>
<div class="paragraph">
<p>The Dockerfiles to build the registries are in the root directory of the respective GitHub repository.</p>
</div>
<div class="sect3">
<h4 id="building-the-images-of-the-plug-in-registry_building-the-images-of-the-registries">Building the images of the plug-in registry</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command</p>
<div class="listingblock">
<div class="content">
<pre>$ docker build -t my-plugin-registry ./che-plugin-registry/</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="building-the-images-of-the-devfile-registry_building-the-images-of-the-registries">Building the images of the devfile registry</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command</p>
<div class="listingblock">
<div class="content">
<pre>$ docker build -t my-devfile-registry ./che-devfile-registry</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-the-registries_building-and-running-a-custom-registry-image">Deploying the registries</h3>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>The <code>my-plugin-registry</code> and <code>my-devfile-registry</code> images used in this section are built using the <code>docker</code> command. This section assumes that these images are available on the Kubernetes and OpenShift cluster where Che is deployed.</p>
</div>
<div class="paragraph">
<p>This is true on Minishift or Minikube, for example, if before running the <code>docker build</code> commands, the user executed the <code>eval $\{minikube docker-env}</code> command (or, the <code>eval $\{minishift docker-env}</code> command for Minishift).</p>
</div>
<div class="paragraph">
<p>Otherwise, these images can be pushed to a container registry (public, such as <code>quay.io</code>, or the DockerHub, or a private registry).</p>
</div>
<div class="sect3">
<h4 id="deploying-registries-in-kubernetes_deploying-the-registries">Deploying registries in Kubernetes</h4>
<div class="paragraph">
<div class="title">Procedure</div>
<p>A Helm chart for the plug-in registry is available in the <code>/kubernetes/che-plugin-registry/</code> directory of the GitHub repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To deploy the plug-in registry using the Helm chart, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>NAMESPACE=<em>&lt;namespace-name&gt;</em>     <i class="conum" data-value="1"></i><b>(1)</b>
DOMAIN=<em>&lt;kubernetes-cluster-domain&gt;</em> <i class="conum" data-value="2"></i><b>(2)</b>
IMAGE="my-plugin-registry"
helm upgrade --install che-plugin-registry \
 --debug \
 --namespace $\{NAMESPACE} \
 --set global.ingressDomain=$\{DOMAIN} \
 --set chePluginRegistryImage=$\{IMAGE} \
 --set chePluginRegistryImagePullPolicy="IfNotPresent" \
 ./kubernetes/che-plugin-registry/</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default Che namespace is <code>che</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>On Minikube, use <code>$(minikube ip).nip.io</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>The devfile registry also has a Helm chart in the <code>deploy/kubernetes/che-devfile-registry/</code> directory of the GitHub repository. To deploy it, run the command:</p>
<div class="listingblock">
<div class="content">
<pre>NAMESPACE=<em>&lt;namespace-name&gt;</em>     <i class="conum" data-value="1"></i><b>(1)</b>
DOMAIN=<em>&lt;kubernetes-cluster-domain&gt;</em> <i class="conum" data-value="2"></i><b>(2)</b>
IMAGE="my-devfile-registry"
helm upgrade --install che-devfile-registry \
 --debug \
 --namespace $\{NAMESPACE} \
 --set global.ingressDomain=$\{DOMAIN} \
 --set cheDevfileRegistryImage=$\{IMAGE} \
 --set cheDevfileRegistryImagePullPolicy="IfNotPresent" \
 ./deploy/kubernetes/che-devfile-registry/</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default Che namespace is <code>che</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>On Minikube, use <code>$(minikube ip).nip.io</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>The Helm chart creates a pod, a service, and an Ingress. To get them, use <code>app=che-plugin-registry</code> (or <code>app=che-plugin-registry</code> for the devfile registry).</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get -o custom-columns=TYPE:.kind,NAME:.metadata.name \
  -l app=che-plugin-registry pod,svc,ingress
TYPE      NAME
Pod       che-plugin-registry-5c7cd8d5c9-zlqlz
Service   che-plugin-registry
Ingress   che-plugin-registry</pre>
</div>
</div>
</li>
<li>
<p>To verify that the new plug-in is correctly published to the plug-in registry, make a request to the registry path <code>/v3/plugins/index.json</code> (or <code>/devfiles/index.json</code> for the devfile registry).</p>
<div class="listingblock">
<div class="content">
<pre>$ URL=$(kubectl get -o 'custom-columns=URL:.spec.rules[0].host' \
  -l app=che-plugin-registry ingress --no-headers)
$ INDEX_JSON=$(curl -sSL http://$\{URL}/v3/plugins/index.json)
$ echo $\{INDEX_JSON} | grep -A 4 -B 5 "\"name\":\"my-plugin\""
,\{
 "id": "my-org/my-plugin/1.0.0",
 "displayName":"This is my first Che plugin",
 "version":"1.0.0",
 "type":"VS Code extension",
 "name":"my-plugin",
 "description":"This plugins shows that we are able to add plugins to the registry...",
 "publisher":"my-org",
 "links": \{"self":"/v3/plugins/my-org/my-plugin/1.0.0" }
}
--
--
,\{
 "id": "my-org/my-plugin/latest",
 "displayName":"This is my first Che plugin",
 "version":"latest",
 "type":"VS Code extension",
 "name":"my-plugin",
 "description":"This plugins shows that we are able to add plugins to the registry...",
 "publisher":"my-org",
 "links": \{"self":"/v3/plugins/my-org/my-plugin/latest" }
}</pre>
</div>
</div>
</li>
<li>
<p>Verify that the Che server points to the URL of the registry. To do this, compare the value of the <code>CHE_WORKSPACE_PLUGIN__REGISTRY__URL</code> parameter in the <code>che</code> ConfigMap (or <code>CHE_WORKSPACE_DEVFILE__REGISTRY__URL</code> for the devfile registry):</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get \
  -o "custom-columns=URL:.data['CHE_WORKSPACE_PLUGIN__REGISTRY__URL']" \
  --no-headers cm/che
URL
http://che-plugin-registry-che.192.168.99.100.nip.io/v3</pre>
</div>
</div>
<div class="paragraph">
<p>with the URL of the Ingress:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ kubectl get -o 'custom-columns=URL:.spec.rules[0].host' \
  -l app=che-plugin-registry ingress --no-headers
che-plugin-registry-che.192.168.99.100.nip.io</pre>
</div>
</div>
</li>
<li>
<p>If they do not match, update the ConfigMap and restart the Che server.</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl edit cm/che
(...)
$ kubectl scale --replicas=0 deployment/che
$ kubectl scale --replicas=1 deployment/che</pre>
</div>
</div>
<div class="paragraph">
<p>When the new registries are deployed and the Che server is configured to use them, the new plug-ins are available in the <strong>Plugin</strong> view of a workspace.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/customization/deploying-plugin-registry-in-kubernetes.png" alt="deploying plugin registry in kubernetes">
</div>
</div>
<div class="paragraph">
<p>The new stacks are displayed in the <strong>New Workspace</strong> tab of the user dashboard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/customization/deploying-devfile-registry-in-kubernetes.png" alt="deploying devfile registry in kubernetes">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="deploying-registries-in-openshift_deploying-the-registries">Deploying registries in OpenShift</h4>
<div class="paragraph">
<div class="title">Procedure</div>
<p>An OpenShift template to deploy the plug-in registry is available in the <code>openshift/</code> directory of the GitHub repository.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To deploy the plug-in registry using the OpenShift template, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>NAMESPACE=<em>&lt;namespace-name&gt;</em>  <i class="conum" data-value="1"></i><b>(1)</b>
IMAGE_NAME="my-plugin-registry"
IMAGE_TAG="latest"
oc new-app -f openshift/che-plugin-registry.yml \
 -n "$\{NAMESPACE}" \
 -p IMAGE="$\{IMAGE_NAME}" \
 -p IMAGE_TAG="$\{IMAGE_TAG}" \
 -p PULL_POLICY="IfNotPresent"</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default Che namespace is <code>che</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>The devfile registry has an OpenShift template in the <code>deploy/openshift/</code> directory of the GitHub repository. To deploy it, run the command:</p>
<div class="listingblock">
<div class="content">
<pre>NAMESPACE=<em>&lt;namespace-name&gt;</em>  <i class="conum" data-value="1"></i><b>(1)</b>
IMAGE_NAME="my-devfile-registry"
IMAGE_TAG="latest"
oc new-app -f openshift/che-devfile-registry.yml \
 -n "$\{NAMESPACE}" \
 -p IMAGE="$\{IMAGE_NAME}" \
 -p IMAGE_TAG="$\{IMAGE_TAG}" \
 -p PULL_POLICY="IfNotPresent"</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The default Che namespace is <code>che</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check if the registries are deployed successfully on OpenShift. The steps to check are similar to the Kubernetes steps. For details, see the <a href="#deploying-registries-in-kubernetes_deploying-the-registries">Deploying registries in Kubernetes</a> section. The only difference is that, on OpenShift, Ingresses are replaced with routes.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="including-the-plug-in-binaries-in-the-registry-image_customizing-the-devfile-and-plug-in-registries">Including the plug-in binaries in the registry image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The plug-in registry only hosts Che plug-in metadata. The binaries are usually referred through a link in the <code>meta.yaml</code> file. In some cases, such as offline environments, it may be necessary to make the binaries available inside the registry image.</p>
</div>
<div class="paragraph">
<p>This section describes how to modify a plug-in <code>meta.yaml</code> file to point to a local file inside the container and rebuild a new registry that contains the modified plug-in <code>meta.yaml</code> file and the binary. In the following example, the Java plug-in that refers to two remote VS Code extensions binaries is considered.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the binaries locally.</p>
<div class="listingblock">
<div class="content">
<pre>$ ORG=redhat
$ NAME=java11
$ VERSION=latest
$ URL_VS_CODE_EXT1="https://github.com/microsoft/vscode-java-debug/releases/download/0.19.0/vscode-java-debug-0.19.0.vsix[_https://github.com/microsoft/vscode-java-debug/releases/download/0.19.0/vscode-java-debug-0.19.0.vsix_]"
$ URL_VS_CODE_EXT2="https://download.jboss.org/jbosstools/static/jdt.ls/stable/java-0.46.0-1549.vsix[_https://download.jboss.org/jbosstools/static/jdt.ls/stable/java-0.46.0-1549.vsix_]"
$ VS_CODE_EXT1=https://github.com/microsoft/vscode-java-debug/releases/download/0.19.0/vscode-java-debug-0.19.0.vsix[_vscode-java-debug-0.19.0.vsix_]
$ VS_CODE_EXT2=https://download.jboss.org/jbosstools/static/jdt.ls/stable/java-0.46.0-1549.vsix[_java-0.46.0-1549.vsix_]
$ curl -sSL -o ./che-plugin-registry/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/$\{VS_CODE_EXT1} \
  $\{URL_VS_CODE_EXT1}
$ curl -sSL -o ./che-plugin-registry/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/$\{VS_CODE_EXT2} \
  $\{URL_VS_CODE_EXT2}</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the plugin-registry URL.</p>
<div class="listingblock">
<div class="content">
<pre>FIXME</pre>
</div>
</div>
</li>
<li>
<p>Update the URLs in the <code>meta.yaml</code> file, so that they point to the VS Code extension binaries that are saved in the registry container:</p>
<div class="listingblock">
<div class="content">
<pre>$ NEW_URL_VS_CODE_EXT1=http://$\{PLUGIN_REG_URL}/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/$\{VS_CODE_EXT1}
$ NEW_URL_VS_CODE_EXT2=http://$\{PLUGIN_REG_URL}/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/$\{VS_CODE_EXT2}
$ sed -i -e 's/$\{URL_PLUGIN1}/$\{NEW_URL_VS_CODE_EXT1}/g' \
  ./che-plugin-registry/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/meta.yaml
$ sed -i -e 's/$\{URL_PLUGIN2}/$\{NEW_URL_VS_CODE_EXT2}/g' \
  ./che-plugin-registry/v3/plugins/$\{ORG}/$\{NAME}/$\{VERSION}/meta.yaml</pre>
</div>
</div>
</li>
<li>
<p>Build and deploy the plug-in registry using the instructions in the <a href="#building-and-running-a-custom-registry-image_customizing-the-devfile-and-plug-in-registries">Building and running a custom registry image</a> section.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="editing-a-devfile-and-plug-in-at-runtime_customizing-the-devfile-and-plug-in-registries">Editing a devfile and plug-in at runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An alternative to building a custom registry image is to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a registry</p>
</li>
<li>
<p>Modify its content at runtime</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach is simpler and faster. But the modifications are lost as soon as the container is deleted.</p>
</div>
<div class="sect2">
<h3 id="adding-a-plug-in-at-runtime_editing-a-devfile-and-plug-in-at-runtime">Adding a plug-in at runtime</h3>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a plug-in:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the name of the Kubernetes pod that hosts the plug-in registry container. To do this, filter the <code>app=che-plugin-registry</code> label:</p>
<div class="listingblock">
<div class="content">
<pre>$ PLUGIN_REG_POD=$(kubectl get -o custom-columns=NAME:.metadata.name \
 --no-headers -l app=che-plugin-registry pod)</pre>
</div>
</div>
</li>
<li>
<p>Create the new plug-in directory in the plug-in registry container, if it does not exist:</p>
<div class="listingblock">
<div class="content">
<pre>$ ORG="my-org"
$ PLUGIN="my-plugin"
$ VERSION="1.0.1"
$ kubectl exec $\{PLUGIN_REG_POD} -i -t -- \
 mkdir -p /var/www/html/v3/plugins/$\{ORG}/$\{PLUGIN}/$\{VERSION}</pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>meta.yaml</code> file in the container:</p>
<div class="listingblock">
<div class="content">
<pre>LOCAL_META="$(PWD)/meta.yaml"
$ kubectl cp "$\{LOCAL_META}" \
  $\{PLUGIN_REG_POD}:/var/www/html/v3/plugins/$\{ORG}/$\{PLUGIN}/$\{VERSION}</pre>
</div>
</div>
</li>
<li>
<p>Update the <code>index.json</code> file of the registry:</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl exec $\{PLUGIN_REG_POD} -i -t -- \
  /var/www/html/index_v2.sh v3 &gt; /var/www/html/v3/plugins/index.json</pre>
</div>
</div>
</li>
<li>
<p>The new plug-in can now be used from a Che instance.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-a-devfile-at-runtime_editing-a-devfile-and-plug-in-at-runtime">Adding a devfile at runtime</h3>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To add a devfile:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get the name of the Kubernetes pod that hosts the devfile registry container. To do this, filter the <code>app=che-devfile-registry</code> label:</p>
<div class="listingblock">
<div class="content">
<pre>$ DEVFILE_REG_POD=$(kubectl get -o custom-columns=NAME:.metadata.name \
  --no-headers -l app=che-devfile-registry pod)</pre>
</div>
</div>
</li>
<li>
<p>Create the new devfile directory in the devfile registry container, if it does not exist.</p>
<div class="listingblock">
<div class="content">
<pre>$ STACK="my-stack"
$ kubectl exec $\{DEVFILE_REG_POD} -i -t -- \
  mkdir -p /var/www/html/devfiles/$\{STACK}</pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>devfile.yaml</code> file and the <code>meta.yaml</code> file to the container.</p>
<div class="listingblock">
<div class="content">
<pre>$ LOCAL_META="$(PWD)/meta.yaml"
$ LOCAL_DEVFILE="$(PWD)/devfile.yaml"
$ kubectl cp "$\{LOCAL_META}" \
  $\{DEVFILE_REG_POD}:/var/www/html/devfiles/$\{STACK}
$ kubectl cp "$\{LOCAL_DEVFILE}" \
  $\{DEVFILE_REG_POD}:/var/www/html/devfiles/$\{STACK}</pre>
</div>
</div>
</li>
<li>
<p>Update the <code>index.json</code> file of the registry.</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl exec $\{DEVFILE_REG_POD} -i -t -- \
  /var/www/html/index.sh &gt; /var/www/html/devfiles/index.json</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>

    <div class="tags">
        
        <b>Tags: </b>
        
        
        
    </div>

<!-- 
 -->

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
                    Eclipse Che - Documentation <br/>
                    Site last generated: Aug 1, 2019 <br/>
                    <hr>
                    <a href="http://www.eclipse.org" target="_blank">Eclipse Foundation</a><br/>
                    <a href="http://www.eclipse.org/legal/privacy.php" target="_blank">Privacy Policy</a><br/>
                    <a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">Terms of Use</a><br/>
                    <a href="https://www.eclipse.org/legal/epl-2.0/" target="_blank">Eclipse Public License</a><br/>
                    <a href="http://www.eclipse.org/legal" target="_blank">Legal Resources</a><br/>
                </div>
            </div>
</footer>




    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
